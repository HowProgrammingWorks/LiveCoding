<!DOCTYPE html>
<html>
<body>
<div id="settings">Name: <input id="user" type="text"  class="edit" style="{ width: 10pt; }"></div>
<div id="buttons"></div>
<textarea id="source" class="edit"></textarea>
<style>
html, body { background: #000; color: #fff; }
input { border: 2px solid #339933; }
.edit { background: #000; color: #fff; font-family: "Courier New", Courier, monospace; }
button { border: 0px; padding: 5px 10px; color: #000; background: linear-gradient(to right, #4477dd, #6699ff); }
button:hover { color: #000; background: #66ccff; }
button.selected { color: #000; background: #fff; }
#source { width: 100%; height: 150pt; margin: 5px 0px 0px 0px; }
</style>
<script>

  const socket = new WebSocket('ws://127.0.0.1/');

  const user = document.getElementById('user');
  const buttons = document.getElementById('buttons');
  const settings = document.getElementById('settings');
  const clients = {};
  let selectedClient = null;
  let selectedButton = null;

  const toElement = (html) => new DOMParser()
    .parseFromString(html, 'text/html')
    .body.childNodes[0];

  const addClient = (client) => {
    const button = toElement(
      '<button id="button' + client.name + '">' + client.name + '</button>'
    );
    buttons.appendChild(button);
    button.clientName = client.name;
    button.addEventListener('click', () => {
      if (button.clientName !== selectedButton) {
        if (selectedButton) {
          selectedButton.className = '';
        }
        button.className = 'selected';
        selectedButton = button;
        selectedClient = button.clientName;
      }
    });
    clients[client.name] = { button, client, text };
  };

  user.addEventListener('keydown', (event) => {
    if (event.keyCode === 13) {
      const event = {
        client: {
          name: user.value
        }
      };
      settings.hidden = true;
      socket.send(JSON.stringify(event));
      addClient(event.client);
    }
  });

  const keyup = (event) => {
    socket.send(JSON.stringify({
      cell: event.target.id,
      value: event.target.value
    }));
  };

  socket.onmessage = (event) => {
    const change = JSON.parse(event.data);
    addClient(change.client);
  };

</script>
</body>
</html>
